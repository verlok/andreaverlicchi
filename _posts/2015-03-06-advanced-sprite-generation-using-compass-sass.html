---
layout: post
title: Advanced sprite generation using Compass (SASS)
date: 2015-03-06 08:17:21 +01:00
categories:
- development
tags: []
---
<p>Spriting is a way to improve performance in your website by putting many images (or icons) in a single larger image, in order to make a single HTTP request instead of many.</p>
<p>You could manually create the sprite map (the single larger image) using your favorite image editor and cutting it in CSS, maybe using a tool like <a href="http://www.spritecow.com/">SpriteCow</a> to make the process simpler.</p>
<p>Or you can create sprite maps using Compass.</p>
<h2>Creating sprites with Compass</h2>
<h3>The simple way</h3>
<p>The simpler way to create a sprite with Compass requires you to import a folder of images in your project, then generate a class for each sprite. You can do that by using the following code:</p>

{% highlight sass %}
// Required Compass tool import
@import "compass/utilities/sprites";
// Importing all the png images under the flags folder
@import "flags/*.png";
// Generate a CSS class for each sprite
@include all-flags-sprites;
{% endhighlight %}

<p>Example of CSS output:</p>

{% highlight css %}
.flags-it,
.flags-de,
.flags-fr { 
  background: url('/images/flags-s34fe0604ab.png') no-repeat; }

.flags-it { background-position: 0 0; }
.flags-de { background-position: 0 -32px; }
.flags-fr { background-position: 0 -64px; }
{% endhighlight %}

<p>This can be enough for your needs... but you want more, don't you?</p>
<p><!--more--></p>
<h3>The considering pixel density + spacing between sprites + size generating + offset managing way</h3>
<p>Skipping all the others way you can do sprites generation with Compass, I found out that if you have to do the following:</p>
<ul>
<li>Generate dimensions of the box equals to the sprite ones
  </li>
<li>Use an offset inside the box
  </li>
<li>Spacing sprites inside the sprite map
  </li>
<li>Manage 1x, 2x, 3x density displays
  </li>
<li>Optimize sprite generation time
</li>
</ul>
<p>The only way to do spriting with Compass is to create your own mixins which use Compass base mixins under the hood.</p>
<h3>_mixins.scss</h3>
<p>I created the following mixins, that I usually put in a separate _mixins.scss partial.</p>

{% highlight scss %}
// N-ple density sprite
@mixin useNxSprite($sprite, $spriteMap, $spriteUrl, /* OPTIONAL PARAMETERS -> */ $multiplier: 1, $renderSize: false, $offsetX: 0, $offsetY: 0) {
  $spritePosition: sprite-position($spriteMap, $sprite, $offsetX * $multiplier, $offsetY * $multiplier);
  background: transparent $spriteUrl no-repeat nth($spritePosition, 1) / $multiplier nth($spritePosition, 2) / $multiplier;
  @if ($multiplier > 1) {
    background-size: (image-width(sprite-path($spriteMap)) / $multiplier) (image-height(sprite-path($spriteMap)) / $multiplier);
  }
  @if ($renderSize) {
    height: image-height(sprite-file($spriteMap, $sprite)) / $multiplier;
    width: image-width(sprite-file($spriteMap, $sprite)) / $multiplier;
  }
}
 
// Single and double density sprite
@mixin use1x2xSprite($sprite, $sprite1xMap, $sprite2xMap, $sprite1xUrl, $sprite2xUrl, /* OPTIONAL PARAMETERS -> */ $renderSize: false, $offsetX: 0, $offsetY: 0) {
  @include useNxSprite($sprite, $sprite1xMap, $sprite1xUrl, 1, $renderSize, $offsetX, $offsetY);
  @media (-webkit-min-device-pixel-ratio: 1.5), (min-resolution: 144dpi) {
    @include useNxSprite($sprite, $sprite2xMap, $sprite2xUrl, 2, $renderSize, $offsetX, $offsetY);
  }
}
{% endhighlight %}

<h3>_variables.scss</h3>
<p>This is the file where you define all the variables for your site, that you're going to use across all your scss files.</p>
<p>In your _variables.scss file you should define the spacing between sprites in sprite map images.</p>

{% highlight scss %}
// Generic spacing (at 1x) for sprites
$spacing-sprites-generic: 10px;
{% endhighlight %}

<h3>_flagSprites.scss</h3>
<p>This is the file where you define the variables and the mixins for your sprites.</p>
<p>I suggest to use a _sprites.scss partial different from you _variables.scss, and to @import _sprites.scss only in scss files that requires sprites. This speeds up build time a lot, by avoiding frequent images check on the file system.</p>

{% highlight scss %}
// FlagSprites MAPS and URLS
$flagSprites1xMap: sprite-map("flagSprites1x/*.png", $spacing: $spacing-sprites-generic);
$flagSprites2xMap: sprite-map("flagSprites2x/*.png", $spacing: $spacing-sprites-generic * 2);
$flagSprites1xUrl: sprite-url($flagSprites1xMap);
$flagSprites2xUrl: sprite-url($flagSprites2xMap);

// FlagSprites mixin
@mixin flagSprites($spriteName, $renderSize: false, $offsetX: 0, $offsetY: 0) {
    @include use1x2xSprite($spriteName, $flagSprites1xMap, $flagSprites2xMap, $flagSprites1xUrl, $flagSprites2xUrl, $renderSize, $offsetX, $offsetY);
}
{% endhighlight %}

<h3>final_file.scss</h3>
<p>In your final scss file you can use the sprite doing the following:</p>
<h4>Simple usage</h4>
<p>If you don't need space around your sprite and you don't want Compass to generate box dimensions for you, you can simply do the following.</p>

{% highlight scss %}
@import "compass/utilities/sprites";
@import "_variables";
@import "_flagSprites";
 
// Simple usage
.exampleSimple {
    @include flagSprites(Italy);
}
{% endhighlight %}

<p>That will produce the following:</p>
{% highlight css %}
.exampleSimple {
  background: transparent url('../img/flagSprites1x-s479625030c.png') no-repeat 0 -882px;
}
@media (-webkit-min-device-pixel-ratio: 1.5), (min-resolution: 144dpi) {
  .exampleSimple {
    background: transparent url('../img/flagSprites2x-s9a855cf705.png') no-repeat 0 -882px;
    background-size: 32px 2048px;
  }
}
{% endhighlight %}

<h4>With box size generation</h4>
<p>If you want Compass to generate box dimensions for you, you should do the following.</p>

{% highlight scss %}
@import "compass/utilities/sprites";
@import "_variables";
@import "_flagSprites";

.exampleWithDimensions {
    @include flagSprites(Italy, true);
}
{% endhighlight %}

<p>That will produce the following:</p>
{% highlight css %}
.exampleWithDimensions {
  background: transparent url('../img/flagSprites1x-s479625030c.png') no-repeat 0 -882px;
  height: 32px;
  width: 32px;
}
@media (-webkit-min-device-pixel-ratio: 1.5), (min-resolution: 144dpi) {
  .exampleWithDimensions {
    background: transparent url('../img/flagSprites2x-s9a855cf705.png') no-repeat 0 -882px;
    background-size: 32px 2048px;
    height: 32px;
    width: 32px;
  }
}
{% endhighlight %}

<h4>With box size generation</h4>
<p>If you don't want Compass to generate box dimensions for you, but you want to use an offset inside the box, you should do the following.</p>

{% highlight scss %}
@import "compass/utilities/sprites";
@import "_variables";
@import "_flagSprites";

.exampleWithPadding {
    @include flagSprites(Italy, false, 10, 10);
    width: 52px; height: 52px;
}
{% endhighlight %}

<p>That will produce the following:</p>
{% highlight css %}
.exampleWithPadding {
  background: transparent url('../img/flagSprites1x-s479625030c.png') no-repeat 10px -872px;
  width: 52px;
  height: 52px;
}
@media (-webkit-min-device-pixel-ratio: 1.5), (min-resolution: 144dpi) {
  .exampleWithPadding {
    background: transparent url('../img/flagSprites2x-s9a855cf705.png') no-repeat 10px -872px;
    background-size: 32px 2048px;
  }
}
{% endhighlight %}

